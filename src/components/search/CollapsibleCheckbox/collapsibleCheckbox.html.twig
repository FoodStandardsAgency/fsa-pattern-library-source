{% set spaceless_title = title|replace({" ": ""}) %}
{% set description_id = "accordion__description--" ~ spaceless_title %}
{% set fields_id = "accordion__fields--" ~ spaceless_title %}
<fieldset class="accordion" aria-describedby={{ description_id }}>
  <legend class="accordion__legend">
    <button class="accordion__button {{ open ? "accordion__button--expanded" : ""}}" aria-expanded={{ open ? "true" : "false"}} aria-controls={{ fields_id }}>
      <span class="accordion__title-text">{{ title }}</span>
    </button>
  </legend>
  <p class="accordion__description" id={{ description_id }}></p>
  <div class="accordion__fields {{ open ? "accordion__fields--active" : ""}}" id={{ fields_id }}>
    {% for field in fields %}
      {% if field.results > 0 %}
        <div class="accordion__field">
          <input class="accordion__input" type="checkbox" id="{{ field.id }}">
          <label class="accordion__label" for="{{ field.id }}">{{ field.label }} ({{ field.results }})</label>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</fieldset>

{# This is used to demonstrate keyboard controls when there are multiple collapsible checkboxes in storybook. Please never set multiple to true in production. #}
{% if multiple == true %}
  <fieldset class="accordion" aria-describedby="{{ description_id }}2">
    <legend class="accordion__legend">
      <button class="accordion__button {{ open ? "accordion__button--expanded" : ""}}" aria-expanded={{ open ? "true" : "false"}} aria-controls="{{ fields_id }}2">
        <span class="accordion__title-text">{{ title }}</span>
      </button>
    </legend>
    <p class="accordion__description" id="{{ description_id }}2"></p>
    <div class="accordion__fields {{ open ? "accordion__fields--active" : ""}}" id="{{ fields_id }}2">
      {% for field in fields %}
        {% if field.results > 0 %}
          <div class="accordion__field">
            <input class="accordion__input" type="checkbox" id="{{ field.id }}2">
            <label class="accordion__label" for="{{ field.id }}2">{{ field.label }} ({{ field.results }})</label>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </fieldset>

  <fieldset class="accordion" aria-describedby="{{ description_id }}1">
    <legend class="accordion__legend">
      <button class="accordion__button {{ open ? "accordion__button--expanded" : ""}}" aria-expanded={{ open ? "true" : "false"}} aria-controls="{{ fields_id }}1">
        <span class="accordion__title-text">{{ title }}</span>
      </button>
    </legend>
    <p class="accordion__description" id="{{ description_id }}1"></p>
    <div class="accordion__fields {{ open ? "accordion__fields--active" : ""}}" id="{{ fields_id }}1">
      {% for field in fields %}
        {% if field.results > 0 %}
          <div class="accordion__field">
            <input class="accordion__input" type="checkbox" id="{{ field.id }}1">
            <label class="accordion__label" for="{{ field.id }}1">{{ field.label }} ({{ field.results }})</label>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </fieldset>
{% endif %}
